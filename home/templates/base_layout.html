{% load static %}

<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{{ site_config.full_name }}{% endblock %}</title>
    {% if site_config.favicon %}
        <link rel="shortcut icon" type="image/png" href="{{ site_config.favicon.url }}"/>
    {% endif %}
    <link rel="stylesheet" type="text/css" href="{% static 'typeface-hind/index.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static '@fortawesome/fontawesome-free/css/all.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap-4/dist/css/bootstrap.min.css' %}">
    <link href="{% static 'home/css/style.css' %}" rel="stylesheet">
    <link href="{% static 'blog/css/style.css' %}" rel="stylesheet">
    <link href="{% static 'projects/css/style.css' %}" rel="stylesheet">
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="{% static '@highlightjs/cdn-assets/styles/github.min.css' %}">
    {% block extra_css %}{% endblock %}
    <script type="text/javascript" src="{% static 'jquery-3/dist/jquery.min.js' %}"></script> 
    <script type="text/javascript" src="{% static 'bootstrap-4/dist/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'htmx.org/dist/htmx.min.js' %}"></script>
    <script src="{% static '@highlightjs/cdn-assets/highlight.min.js' %}"></script>
</head>

<body {% block body_attrs %}{% endblock %}>

<!-- Loading Circle - only loads once on initial page load -->
<div id="preloader" style="background: rgba(255, 255, 255, 1.0)">
    <div id="status">
        <div class="status-mes"></div>
    </div>
</div>

{% include 'home/navbar.html' with active_page=active_page %}

<div id="main-content" {% block content_attrs %}{% endblock %}>
    {% block content %}
    {% endblock %}
</div>

{% block extra_js %}{% endblock %}

<script>
    function updateActiveNavLink() {
        const path = window.location.pathname;
        const navItems = document.querySelectorAll('.navbar-nav .nav-item');
        
        navItems.forEach(function(item) {
            item.classList.remove('active');
        });
        
        navItems.forEach(function(item) {
            const link = item.querySelector('.nav-link');
            if (link) {
                const href = link.getAttribute('href');
                // Check for exact match on home, or path starts with for others
                if (path === '/' && href === '/') {
                    item.classList.add('active');
                } else if (path.startsWith('/projects') && href.includes('/projects')) {
                    item.classList.add('active');
                } else if (path.startsWith('/blog') && href.includes('/blog')) {
                    item.classList.add('active');
                }
            }
        });
    }
    
    // Run on page load
    document.addEventListener('DOMContentLoaded', function() {
        updateActiveNavLink();
        // Initialize syntax highlighting
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightElement(block);
        });
    });
    
    // Run after HTMX swaps content
    document.body.addEventListener('htmx:afterSwap', function() {
        updateActiveNavLink();
        // Re-initialize syntax highlighting for new content
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightElement(block);
        });
        // Re-attach modal handlers for blog images
        assignBlogImageModals();
    });
    document.body.addEventListener('htmx:pushedIntoHistory', updateActiveNavLink);
    
    // Hide preloader on page load
    $(document).ready(function() {
        $('#preloader').delay(700).fadeOut(700);
        assignBlogImageModals();
    });
    
    // Function to make blog post images clickable for modal view
    function assignBlogImageModals() {
        const modal = document.getElementById("myModal");
        if (!modal) return;
        
        const modalImg = document.getElementById("img01");
        const modalVid = document.getElementById("vid01");
        const captionText = document.getElementById("caption");
        
        // Target images inside blog content
        document.querySelectorAll('.blog-content img').forEach(function(img) {
            img.style.cursor = 'pointer';
            img.onclick = function() {
                modal.style.display = "block";
                modalVid.style.display = "none";
                modalImg.style.display = "block";
                modalImg.style.width = "80%";
                modalImg.src = this.src;
                captionText.innerHTML = this.alt || '';
            };
        });
        
        // Close modal handlers
        const closeBtn = modal.querySelector('.close');
        if (closeBtn) {
            closeBtn.onclick = function() {
                modal.style.display = "none";
            };
        }
        
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        };
    }
</script>

</body>

</html>
